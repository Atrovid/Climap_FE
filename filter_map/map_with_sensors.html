<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Heatmap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <style>
        #map {
            height: 100%;
            width: 100%;
        }
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        jsonObj = [
{
"latitude": 46.7196181682508,
"longitude": 77.7462972278178,

"heat": [
{
"celsiusDegree": 43.2744973740857
}
],
"sound": [
{
"decibel": 92.9210643567959
}
],
"brightness": [
{
"lux": 51.5106507489826
}
],
"dateDataCapture": "2023-05-267T12:43:30.700+00:00",
"humidity": [
{
"particlesPerCubicCentimeter": 72.8533518480013
}
],
"microparticle": [
{
"particlesPerCubicCentimeter": 63.1046775677967
}
],

"idCharacteristic": 3301
}
]
        // const fs = require('fs');
        // Fonction pour lire les données JSON
    function processJSONData(jsonData) {
        // const fileContent = fs.readFileSync(filename, 'utf-8');
        // const jsonData = JSON.parse(fileContent);
        var result = [];

        for (var i = 0; i < jsonData.length; i++) {
            
            var dataInterm = [];
            dataInterm[0] = jsonData[i].latitude;
            dataInterm[1] = jsonData[i].longitude;
            dataInterm[2] = jsonData[i].heat[0].celsiusDegree;
            dataInterm[3] = jsonData[i].sound[0].decibel;
            dataInterm[4] = jsonData[i].brightness[0].lux;
            dataInterm[5] = jsonData[i].dateDataCapture;
            dataInterm[6] = jsonData[i].humidity[0].particlesPerCubicCentimeter;
            dataInterm[7] = jsonData[i].microparticle[0].particlesPerCubicCentimeter;
            dataInterm[8] = jsonData[i].idCharacteristic;
            result.push(dataInterm);

        }

        return result;
    }

        // cette partie est à decommenter lorsqu'on commence à utuiliser des fichiers json
        // fetch('http://127.0.0.1:8080/message.json')
        //   .then(response => response.json())
        //   .then(jsonData => {
            // Appeler la fonction pour recupérer les données JSON
            const SensorsData = processJSONData(jsonObj);

            // Initialiser la carte sur Caen
            var mymap = L.map('map').setView([49.1828, -0.3708], 13);

            // Ajouter la couche OpenStreetMap à la carte
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(mymap);

            L.heatLayer(SensorsData, { radius: 25 }).addTo(mymap);
            

            // Ajouter des tooltips pour chaque point
            SensorsData.forEach(point => {
                L.marker([point[0], point[1]])
                    .bindTooltip('Sensor n° ' + point[8] + '\n Heat' + point[2] +
                    '\nSound ' + point[3] + '\nBrightness ' + point[4] + '\nHumidity ' + point[6] +
                    '\nMicroparticle ' + point[7]) 
                    .addTo(mymap);
            });
        // })
        //   .catch(error => console.error('Erreur lors du chargement du fichier JSON :', error));
    </script>
</body>
</html>
